function showLog(n,t,i){i==1?log1.innerHTML+="\n"+n+" "+(t||""):i==2?log2.innerHTML+="\n"+n+" "+(t||""):(log1.innerHTML+="\n"+n+" "+(t||""),log2.innerHTML+="\n"+n+" "+(t||""))}function startUserMedia(n){let t=audio_context.createMediaStreamSource(n),i=audio_context.createMediaStreamSource(n);showLog("Media stream created.");recorder1=new Recorder(t);recorder2=new Recorder(i);showLog("Recorder initialised.")}function startRecording(n,t){t==1?recorder1&&recorder1.record():recorder2&&recorder2.record();n.disabled=!0;n.nextElementSibling.disabled=!1;showLog("Recording...",null,t)}function stopRecording(n,t){t==1?recorder1&&recorder1.stop():recorder2&&recorder2.stop();showLog("Stopped recording.",null,t);n.disabled=!0;n.previousElementSibling.disabled=!1;createDownloadLink(t);showLog("Stopped recording.",null,t);t==1?recorder1.clear():recorder2.clear()}function handleAudioEvent(n,t){let r=document.createElement("li"),f=document.createElement("audio"),i=document.createElement("a"),o=document.createElement("br"),e=URL.createObjectURL(n),u=document.createElement("a");f.controls=!0;f.src=e;i.href=e;u.href="#";u.innerHTML="Tải lên";i.download=(new Date).toISOString().replaceAll(":","-");switch(n.type){case"audio/wav":i.download+=".wav";break;case"audio/mpeg":i.download+=".mp3";break;case"audio/ogg":i.download+=".ogg";break;default:alert("Don't support this audio file type, please choose other audio types, e.g. *.mp3, *.wav, *.ogg");return}u.addEventListener("click",function(){let r=new XMLHttpRequest;r.onload=function(n){this.readyState===4&&showLog("Server returned: ",n.target.responseText,t)};let u=new FormData;u.append("audio_data",n,i.download);r.open("POST","/api/UploadAudio",!0);r.send(u)});i.innerHTML=i.download;r.appendChild(f);r.appendChild(o);r.appendChild(i);r.appendChild(document.createTextNode(" "));r.appendChild(u);t==1?recordingslist1.appendChild(r):recordingslist2.appendChild(r)}function createDownloadLink(n){n==1?recorder1&&recorder1.exportWAV(n=>handleAudioEvent(n,1)):recorder2&&recorder2.exportWAV(n=>handleAudioEvent(n,2))}function deleteAll(n){n==1?(recordingslist1.innerHTML="",btnAddFile1.value="",log1.innerHTML=""):(recordingslist2.innerHTML="",btnAddFile2.value="",log2.innerHTML="")}let audio_context,recorder1,recorder2;window.onload=function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;window.URL=window.URL||window.webkitURL;audio_context=new AudioContext;showLog("audio context set up.");showLog("navigator.getUserMedia "+(navigator.getUserMedia?"available.":"not present!"))}catch(n){alert("No web audio support in this browser!")}navigator.getUserMedia({audio:!0},startUserMedia,function(n){showLog("No live audio input: "+n)});btnAddFile1.addEventListener("change",n=>handleAudioEvent(n.target.files[0],1));btnAddFile2.addEventListener("change",n=>handleAudioEvent(n.target.files[0],2))};